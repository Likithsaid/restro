<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link rel="icon" href="logo.jpg" type="image/jpeg">
</head>
<body>

<header>
    <div class="header-top">
        <div class="restaurant-brand">
            <div class="logo-container">
                <img src="logo.jpg" alt="Szechuan Dragon Logo" class="logo-img">
                <div class="logo-text">
                    <h1 class="restaurant-name">Szechuan Dragon</h1>
                    <p class="restaurant-tagline">Fiery Flavors, Exotic Tastes</p>
                </div>
            </div>
        </div>

        <nav class="header-nav">
            <a href="index.html">Home</a>
            <a href="menu.html">Menu</a>
            <a href="help.html">Help</a>
            <a href="cart.html" class="cart-icon">
                Your Cart <span class="cart-count" id="cartCount">0</span>
            </a>
        </nav>
    </div>
</header>

<main class="container mt-4">
    <h2 class="mb-4">Enter Your Details</h2>

    <form id="orderForm" class="border rounded p-4">
        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label fw-bold">First Name *</label>
                <input class="form-control" id="firstName" required>
            </div>
            <div class="col-md-6">
                <label class="form-label fw-bold">Last Name *</label>
                <input class="form-control" id="lastName" required>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Address *</label>
            <input class="form-control" id="address" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Address 2</label>
            <input class="form-control" id="address2">
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <label class="form-label fw-bold">Phone *</label>
                <input class="form-control" id="phone" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Alternate Phone</label>
                <input class="form-control" id="alternatePhone">
            </div>
        </div>

        <div class="d-flex justify-content-between">
            <a href="cart.html" class="btn btn-secondary">Back</a>
            <button type="submit" class="btn btn-primary">Request Order</button>
        </div>
    </form>
</main>

<script>
const BACKEND_URL = "https://restaurant-webapp-186k.onrender.com";

let cartItems = JSON.parse(localStorage.getItem("cart") || "[]");

document.getElementById("cartCount").textContent =
    cartItems.reduce((s, i) => s + (i.quantity || 1), 0);

if (cartItems.length === 0) {
    alert("Cart is empty");
    window.location.href = "index.html";
}

document.getElementById("orderForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const orderData = {
        firstName: firstName.value,
        lastName: lastName.value,
        address: address.value,
        address2: address2.value,
        phone: phone.value,
        alternatePhone: alternatePhone.value,
        cartItems
    };

    try {
        const res = await fetch(`${BACKEND_URL}/api/submit-order`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(orderData)
        });

        const result = await res.json();

        if (result.success) {
            localStorage.removeItem("cart");

            // âœ… CORRECT REDIRECT (NO SPACE)
            window.location.href = `order.html?orderId=${result.orderId}`;
        } else {
            alert("Order failed");
        }
    } catch (err) {
        alert("Network error");
        console.error(err);
    }
});
</script>

</body>
</html>
